# 📊 Multi-Analysis Data Directory

This directory contains all processed data files for the Multi-Analysis application.

## 📁 Directory Structure

```
data/
├── README.md                           # This file
├── listings.json                       # Processed MLS listing data
├── comps.json                          # Processed comparable sales data
├── rents.json                          # Rental data
├── bha-rents.json                      # BHA rental data
├── bha-rents-comprehensive.json        # Comprehensive BHA rental data
└── overrides.json                      # User override data
```

## 🔄 Data Flow

### **Current Architecture**
```
CSV Files (seed/data/) → Loaders (seed/*.js) → JSON Files (data/) → Application
```

### **Future API Architecture**
```
API Endpoints → Loaders (seed/*.js) → JSON Files (data/) → Application
```

## 📋 Data Files

### **Core Data**
- **`listings.json`** (515KB, 25,835 lines)
  - **Source**: `seed/data/mls.csv`
  - **Loader**: `seed/mls-loader.js`
  - **Content**: MLS listing data with property details, pricing, and unit mix
  - **Structure**: `{ generatedAt, count, listings: [...] }`

- **`comps.json`** (4.2MB)
  - **Source**: `seed/data/comps.csv`
  - **Loader**: `seed/comps-loader.js`
  - **Content**: Comparable sales data for market analysis
  - **Structure**: `{ generatedAt, count, listings: [...] }`

### **Rental Data**
- **`rents.json`** (79KB, 3,892 lines)
  - **Source**: Generated by rent data processing
  - **Content**: General rental market data
  - **Usage**: Rental rate analysis and comparisons

- **`bha-rents.json`** (18KB, 764 lines)
  - **Source**: BHA payment standards
  - **Content**: BHA rental data for specific areas
  - **Usage**: BHA-compliant rental analysis

- **`bha-rents-comprehensive.json`** (72KB, 3,982 lines)
  - **Source**: Comprehensive BHA data processing
  - **Content**: Complete BHA rental data with multiple years
  - **Usage**: Comprehensive BHA analysis and future projections

### **User Data**
- **`overrides.json`** (3.2KB, 161 lines)
  - **Source**: User input and customizations
  - **Content**: User-defined overrides for property analysis
  - **Usage**: Custom property valuations and assumptions

## 🏗️ Data Architecture

### **Current Implementation**
The application uses a **seed data architecture** that processes CSV files into JSON:

1. **Raw Data**: CSV files in `seed/data/`
2. **Processing**: Loader scripts in `seed/`
3. **Output**: Processed JSON files in `data/`
4. **Consumption**: Application loads from `data/`

### **API Integration Ready**
The architecture is designed for easy API integration:

1. **Replace CSV sources** with API endpoints
2. **Keep same JSON structure** for compatibility
3. **Update loaders** to fetch from APIs
4. **Maintain same file paths** for application

## 🔧 Data Processing

### **Loader Scripts**
- **`seed/mls-loader.js`** - Processes MLS CSV to listings.json
- **`seed/comps-loader.js`** - Processes comps CSV to comps.json
- **`seed/rent-loader.js`** - Processes rental data

### **Data Transformation**
Each loader performs consistent data transformation:
- **Normalization**: Standardize field names and formats
- **Validation**: Filter out invalid records
- **Enrichment**: Add derived fields and calculations
- **Structuring**: Convert to consistent JSON format

### **Error Handling**
- **File validation**: Check for required CSV files
- **Data validation**: Filter out invalid records
- **Fallback paths**: Multiple locations for data loading
- **Error reporting**: Clear error messages for missing data

## 🚀 API Integration Strategy

### **Data Service Abstraction**
```typescript
interface DataService {
  getListings(): Promise<Listing[]>;
  getComps(): Promise<Comp[]>;
  getRents(): Promise<Rent[]>;
  getBHARents(): Promise<BHARent[]>;
}

class CSVDataService implements DataService {
  // Current CSV-based implementation
}

class APIDataService implements DataService {
  // Future API-based implementation
}
```

### **Migration Steps**
1. **Create data service layer** with interface
2. **Implement API service** alongside CSV service
3. **Update loaders** to use service abstraction
4. **Switch data source** via configuration
5. **Maintain backward compatibility**

### **Benefits**
- **Seamless transition**: No application changes needed
- **Data consistency**: Same JSON structure maintained
- **Flexibility**: Easy to switch between CSV and API
- **Testing**: Can test with CSV before API integration

## 📊 Data Quality

### **Validation Rules**
- **Required fields**: LIST_NO, ADDRESS, LIST_PRICE
- **Data types**: Numbers for prices, dates for timestamps
- **Ranges**: Reasonable values for prices, dates, etc.
- **Consistency**: Cross-field validation (e.g., units vs bedrooms)

### **Quality Metrics**
- **Record counts**: Track processed vs valid records
- **Data completeness**: Monitor missing field percentages
- **Data accuracy**: Validate against known ranges
- **Processing time**: Monitor loader performance

## 🔄 Data Updates

### **Current Process**
1. **Update CSV files** in `seed/data/`
2. **Run loader scripts** to regenerate JSON
3. **Restart application** to load new data

### **Future Process**
1. **API data updates** automatically
2. **Scheduled processing** via cron jobs
3. **Incremental updates** for efficiency
4. **Version control** for data changes

## 📝 Usage Examples

### **Running Data Loaders**
```bash
# Process MLS data
node seed/mls-loader.js

# Process comps data
node seed/comps-loader.js

# Process rental data
node seed/rent-loader.js
```

### **Data Validation**
```bash
# Check data file sizes
ls -lh data/*.json

# Validate JSON structure
node -e "console.log(JSON.parse(require('fs').readFileSync('data/listings.json')).count)"
```

### **API Integration (Future)**
```bash
# Switch to API data source
export DATA_SOURCE=api

# Run loaders with API
node seed/mls-loader.js  # Will use API instead of CSV
```

## 🔍 Troubleshooting

### **Common Issues**
1. **Missing CSV files**: Check `seed/data/` directory
2. **Invalid JSON**: Run loaders to regenerate data
3. **Data inconsistencies**: Validate CSV format
4. **Performance issues**: Check file sizes and processing time

### **Debug Commands**
```bash
# Check data file existence
ls -la data/*.json

# Validate JSON syntax
jq . data/listings.json > /dev/null

# Check data counts
jq '.count' data/*.json
```

## 📚 Related Documentation

- **[Seed Data Guide](../seed/README.md)** - CSV processing and loader scripts
- **[API Integration Plan](../docs/API_INTEGRATION_PLAN.md)** - Future API integration strategy
- **[Data Schema](../docs/DATA_SCHEMA.md)** - Detailed data structure documentation

---

**Note**: This data architecture is designed for easy migration from CSV to API sources while maintaining application compatibility.
